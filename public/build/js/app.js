let previewImages=[],uploadedImages=[],deleteuploadedImages=[],mainpreviewImage=0,inputRef=null,showingSlide=-1,myid=0,provincias=[],cantones=[],distritos=[],plan=[],category=[],tagcount=1;function eventListeners(){const e=document.getElementById("mobile-menu"),t=document.getElementById("mobile-menu-search");e.addEventListener("click",navegacionResponsive),t.addEventListener("click",searchResponsive)}function navegacionResponsive(){document.getElementById("navegation").classList.toggle("show-nav")}function searchResponsive(){document.getElementById("search-container").classList.toggle("show-search")}function setmainimg(){mainpreviewImage=showingSlide,findmainimg(),document.getElementById("img-main").value=mainpreviewImage}function findmainimg(){document.getElementById("main-icon-main").src=mainpreviewImage==showingSlide?"/images/app/principal-img-act.svg":"/images/app/principal-img-des.svg"}function previewImage(e,t){if(inputRef=e.target,!inputRef.files.length)return;const n=document.querySelector('input[type="file"]'),i=n.files,o=[];previewImages.length;for(let e=0;e<i.length;e++){let t=!1;if(previewImages.length>0){for(let n=0;n<previewImages.length;n++)if(i[e].name==previewImages[n].name){t=!0;break}}else mainpreviewImage=0;!1===t&&o.push(i[e])}const s=new DataTransfer;for(let e=0;e<previewImages.length;e++)s.items.add(previewImages[e]);for(let e=0;e<o.length;e++)s.items.add(o[e]);n.files=s.files,previewImages=s.files,showingSlide<0&&(showingSlide=0,objectURL=URL.createObjectURL(previewImages[0]),document.getElementById("previewImageDiv").classList.remove("hidden"),document.getElementById("imgPreview").setAttribute("src",objectURL),document.getElementById("imgWebp").setAttribute("srcset",objectURL),document.getElementById("imgJPG").setAttribute("srcset",objectURL)),previewImages.length+uploadedImages.length==1?(document.getElementById("btn-prev").classList.add("hidden"),document.getElementById("btn-next").classList.add("hidden")):(document.getElementById("btn-prev").classList.remove("hidden"),document.getElementById("btn-next").classList.remove("hidden")),setmainimg(),findmainimg()}function changePreviewSlide(e){if(1===e)if(showingSlide+1<uploadedImages.length){showingSlide++;const e="/images/"+uploadedImages[showingSlide];document.getElementById("imgPreview").setAttribute("src",e),document.getElementById("imgWebp").setAttribute("srcset",e),document.getElementById("imgJPG").setAttribute("srcset",e)}else if(previewImages.length+uploadedImages.length==0){showingSlide=0;const e="/images/"+uploadedImages[showingSlide];document.getElementById("imgPreview").setAttribute("src",e),document.getElementById("imgWebp").setAttribute("srcset",e),document.getElementById("imgJPG").setAttribute("srcset",e)}else{if(1===e&&(showingSlide++,previewImages.length+uploadedImages.length<=showingSlide))return showingSlide=-1,void changePreviewSlide(1);try{file=previewImages[showingSlide-uploadedImages.length],objectURL=URL.createObjectURL(file),document.getElementById("imgPreview").setAttribute("src",objectURL),document.getElementById("imgWebp").setAttribute("srcset",objectURL),document.getElementById("imgJPG").setAttribute("srcset",objectURL)}catch(e){}}else if(showingSlide-1<uploadedImages.length&&showingSlide-1>=0){showingSlide--;const e="/images/"+uploadedImages[showingSlide];document.getElementById("imgPreview").setAttribute("src",e),document.getElementById("imgWebp").setAttribute("srcset",e),document.getElementById("imgJPG").setAttribute("srcset",e)}else if(showingSlide-1<0&&0==previewImages.length){showingSlide=previewImages.length+uploadedImages.length-1;const e="/images/"+uploadedImages[showingSlide];document.getElementById("imgPreview").setAttribute("src",e),document.getElementById("imgWebp").setAttribute("srcset",e),document.getElementById("imgJPG").setAttribute("srcset",e)}else{showingSlide--,showingSlide<0&&(showingSlide=previewImages.length+uploadedImages.length-1);try{file=previewImages[showingSlide-uploadedImages.length],objectURL=URL.createObjectURL(file),document.getElementById("imgPreview").setAttribute("src",objectURL),document.getElementById("imgWebp").setAttribute("srcset",objectURL),document.getElementById("imgJPG").setAttribute("srcset",objectURL)}catch(e){}}findmainimg()}function deletePreviewSlide(){if(showingSlide<uploadedImages.length){deleteuploadedImages.push(uploadedImages[showingSlide]);const e=document.createElement("INPUT");e.type="hidden",e.value=uploadedImages[showingSlide],e.name="imgdel[]",document.getElementById("previewImageDiv").append(e),uploadedImages.splice(showingSlide,1)}else{const e=document.querySelector('input[type="file"]'),t=e.files,n=[];for(let e=0;e<t.length;e++)e!==showingSlide-uploadedImages.length?n.push(t[e]):(mainpreviewImage=0,findmainimg());const i=new DataTransfer;for(let e=0;e<n.length;e++)i.items.add(n[e]);e.files=i.files,previewImages=i.files}previewImages.length+uploadedImages.length==0&&(document.getElementById("previewImageDiv").classList.add("hidden"),document.getElementById("imgPreview").setAttribute("src",""),document.getElementById("imgWebp").setAttribute("srcset",""),document.getElementById("imgJPG").setAttribute("srcset",""),showingSlide=-1),previewImages.length+uploadedImages.length<=1?(document.getElementById("btn-prev").classList.add("hidden"),document.getElementById("btn-next").classList.add("hidden")):(document.getElementById("btn-prev").classList.remove("hidden"),document.getElementById("btn-next").classList.remove("hidden")),changePreviewSlide(0),mainpreviewImage==showingSlide+1&&(mainpreviewImage=showingSlide,console.log(mainpreviewImage),findmainimg(),document.getElementById("img-main").value=mainpreviewImage)}function startApp(){}async function getLocation(){try{const e="http://localhost:3000/api/locations",t=await fetch(e,{method:"POST"}),n=await t.json();provincias=n.provincias,cantones=n.cantones,distritos=n.distritos,plan=n.plan,category=n.category,setLocationForm(),setPlanForm()}catch(e){}}function deletetag(e){event.preventDefault();document.getElementById("tag"+e).remove(),tagcount--,elementsdivtag=document.getElementsByClassName("div-tag");for(let e=0;e<elementsdivtag.length;e++)elementsdivtag[e].id="tag"+e;elementsbtntag=document.getElementsByClassName("btn-tag");for(let e=0;e<elementsbtntag.length;e++)elementsbtntag[e].onclick=function(){deletetag(e)};elementsinputtag=document.getElementsByClassName("input-tag");for(let e=0;e<elementsinputtag.length;e++)elementsinputtag[e].name=`tags[${e}]`;0==tagcount&&addTag()}function findUploadePictures(){const e=document.getElementsByClassName("my-image");for(let t=0;t<e.length;t++)uploadedImages.push(e[t].value);mainpreviewImage=document.getElementById("img-main").value;const t=previewImages.length+uploadedImages.length;showingSlide=0,document.getElementById("previewImageDiv").classList.remove("hidden"),document.getElementById("imgPreview").setAttribute("src","/images/"+uploadedImages[showingSlide]),document.getElementById("imgWebp").setAttribute("srcset","/images/"+uploadedImages[showingSlide]),document.getElementById("imgJPG").setAttribute("srcset","/images/"+uploadedImages[showingSlide]),1==t?(document.getElementById("btn-prev").classList.add("hidden"),document.getElementById("btn-next").classList.add("hidden")):(document.getElementById("btn-prev").classList.remove("hidden"),document.getElementById("btn-next").classList.remove("hidden")),findmainimg()}function findTagCount(){try{const e=document.getElementsByClassName("my-tag");if(e.length>0){if(tagcount=e.length,0==tagcount||!tagcount){tagcount=1;const e=document.createElement("DIV");e.id="tag0",e.classList.add("div-tag");const t=document.createElement("INPUT");t.type="text",t.classList.add("input-tag"),t.id="tag",t.placeholder="Servicio que ofreces.",t.value="",t.name="tags[0]";const n=document.createElement("BUTTON");n.onclick=function(){deletetag(0)},n.classList.add("btn-tag"),n.textContent=" X ";const i=document.getElementById("tags");return e.appendChild(t),e.appendChild(n),i.appendChild(e),i.style.display="block",void(i.style.width="100%")}for(let t=0;t<e.length;t++){const t=tagcount,n=document.createElement("DIV");n.id="tag"+t,n.classList.add("div-tag");const i=document.createElement("INPUT");i.type="text",i.classList.add("input-tag"),i.id="tag",i.placeholder="Servicio que ofreces.",i.value=e[t].value,i.name=`tags[${t}]`;const o=document.createElement("BUTTON");o.onclick=function(){deletetag(t)},o.classList.add("btn-tag"),o.textContent=" X ";const s=document.getElementById("tags");n.appendChild(i),n.appendChild(o),s.appendChild(n),s.style.display="block",s.style.width="100%"}}}catch(e){return}}function addTag(){if(event.preventDefault(),5===tagcount)return void Swal.fire({icon:"error",title:"ERROR",text:"Lo sentimos, total de etiquetas ya agregadas",button:"OK"});const e=tagcount,t=document.createElement("DIV");t.id="tag"+e,t.classList.add("div-tag");const n=document.createElement("INPUT");n.type="text",n.classList.add("input-tag"),n.id="tag",n.placeholder="Servicio que ofreces.",n.value="",n.name=`tags[${e}]`;const i=document.createElement("BUTTON");i.onclick=function(){deletetag(e)},i.classList.add("btn-tag"),i.textContent=" X ";const o=document.getElementById("tags");t.appendChild(n),t.appendChild(i),o.appendChild(t),o.style.display="block",o.style.width="100%",tagcount++}function setPlanForm(){const e=document.getElementById("categoryid");for(let t=0;t<category.length;t++){const n=document.createElement("OPTION");n.value=category[t].id,n.text=category[t].name,e.appendChild(n);try{document.getElementById("hcategoryid").value==category[t].id&&(n.selected=!0)}catch(e){}}e.addEventListener("change",e=>{});const t=document.getElementById("plan");for(let e=0;e<plan.length;e++){const n=document.createElement("OPTION");n.value=plan[e].id,n.text=plan[e].name,t.appendChild(n);try{document.getElementById("hplanid").value==plan[e].id&&(n.selected=!0)}catch(e){}}t.addEventListener("change",e=>{})}function setCategoryPanel(){}function setLocationForm(){const e=document.getElementById("provincia");for(let t=0;t<provincias.length;t++){const n=document.createElement("OPTION");n.value=provincias[t].id,n.text=provincias[t].name,e.appendChild(n);try{const e=document.getElementById("hprovincia");if(e.value==provincias[t].name){n.selected=!0;const i=provincias[t].id,o=(e.value,document.getElementById("canton")),s=document.getElementById("distrito"),a=document.getElementById("dcanton");for(let e=o.options.length-1;e>=0;e--){o.options[e]!==a&&o.remove(e)}let d=-1;for(let e=0;e<cantones.length;e++){if(i==cantones[e].idprovincia){const t=document.createElement("OPTION");t.value=cantones[e].id,t.text=cantones[e].name,o.appendChild(t);document.getElementById("hcanton").value==cantones[e].name&&(t.selected=!0,d=cantones[e].id)}const t=document.getElementById("ddistrito");for(let e=s.options.length-1;e>=0;e--){s.options[e]!==t&&s.remove(e)}for(let e=0;e<distritos.length;e++)if(d==distritos[e].idcanton){const t=document.createElement("OPTION");t.value=distritos[e].id,t.text=distritos[e].name,s.appendChild(t);document.getElementById("hdistrito").value==distritos[e].name&&(t.selected=!0)}document.getElementById("canton").addEventListener("change",e=>{const t=e.target.value,n=document.getElementById("ddistrito");for(let e=s.options.length-1;e>=0;e--){s.options[e]!==n&&s.remove(e)}console.log(t);for(let e=0;e<distritos.length;e++)if(t==distritos[e].idcanton){const t=document.createElement("OPTION");t.value=distritos[e].id,t.text=distritos[e].name,s.appendChild(t);document.getElementById("hdistrito").value==distritos[e].name&&(t.selected=!0)}})}}}catch(e){}}addlisteners()}function addlisteners(){document.getElementById("provincia").addEventListener("change",e=>{const t=e.target.value;try{""==e.target.value?document.getElementById("select-box-canton").classList.add("hidden"):document.getElementById("select-box-canton").classList.remove("hidden")}catch(e){}const n=document.getElementById("canton"),i=document.getElementById("distrito"),o=document.getElementById("dcanton");for(let e=n.options.length-1;e>=0;e--){n.options[e]!==o&&n.remove(e)}for(let e=0;e<cantones.length;e++)if(t==cantones[e].idprovincia){const t=document.createElement("OPTION");t.value=cantones[e].id,t.text=cantones[e].name,n.appendChild(t)}const s=document.getElementById("ddistrito");for(let e=i.options.length-1;e>=0;e--){i.options[e]!==s&&i.remove(e)}document.getElementById("canton").addEventListener("change",e=>{const t=e.target.value;try{""==e.target.value?document.getElementById("select-box-distrito").classList.add("hidden"):document.getElementById("select-box-distrito").classList.remove("hidden")}catch(e){}const n=document.getElementById("ddistrito");for(let e=i.options.length-1;e>=0;e--){i.options[e]!==n&&i.remove(e)}for(let e=0;e<distritos.length;e++)if(t==distritos[e].idcanton){const t=document.createElement("OPTION");t.value=distritos[e].id,t.text=distritos[e].name,i.appendChild(t)}})})}function showSection(){const e=document.querySelector(".show");e&&e.classList.remove("show");document.querySelector("#step-"+step).classList.add("show");const t=document.querySelector(".current");t&&t.classList.remove("current");document.querySelector(`[step="${step}"]`).classList.add("current"),findPagesButton()}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",(function(e){step=parseInt(e.target.attributes.step.value),showSection(),findPagesButton()}))})}function findPagesButton(){alert();const e=document.querySelector("#btn-next"),t=document.querySelector("#btn-back");1===step?(t.classList.add("hidden"),e.classList.remove("hidden")):3===step?(t.classList.remove("hidden"),e.classList.add("hidden"),showResume()):(t.classList.remove("hidden"),e.classList.remove("hidden"))}function nextPage(){const e=document.querySelector("#btn-next");e.addEventListener("click",(function(){step>=e||(step++,showSection())}))}function lastPage(){document.querySelector("#btn-back").addEventListener("click",(function(e){step<=firstStep||(step--,showSection())}))}async function findMyServices(){try{id=document.getElementById("accountid").value;const e=new FormData;e.append("userid",id);let t="http://localhost:3000/api/services";const n=await fetch(t,{method:"POST",body:e}),i=await n.json();if(console.log(i),i.length<=0){let e="<h3>No hay servicios</h3>";const t=document.getElementById("product-section");return document.getElementById("product-section").style.gridTemplateColumns="repeat(1, 1fr)",void(t.innerHTML=e)}e.delete("userid");let o="";for(let e=0;e<i.length;e++)0===e?o="'"+i[e].id+"'":o+=",'"+i[e].id+"'";e.append("serviceid",o),t="http://localhost:3000/api/services/pictures";const s=await fetch(t,{method:"POST",body:e}),a=await s.json();t="http://localhost:3000/api/services/tags";const d=await fetch(t,{method:"POST",body:e}),c=await d.json();e.delete("userid"),t="http://localhost:3000/api/locations";const l=await fetch(t,{method:"POST"}),r=await l.json();provincias=r.provincias,cantones=r.cantones,distritos=r.distritos,plan=r.plan,category=r.category,showMyServices(i,a,c)}catch(e){console.log(e)}}function showMyServices(e,t,n){let i="";e.length<=1&&(document.getElementById("product-section").style.gridTemplateColumns="repeat(1, 1fr)"),console.log(e.length),e.forEach(e=>{const o=e.id;let s="";try{const e=t.filter(e=>e.serviceid==o);s=e.find(e=>"1"==e.main).url}catch(e){}const a=e.title,d=e.description;let c="",l="",r="",m="",g="";g+=e.provincia,g+=", ",g+=e.canton,g+=", ",g+=e.distrito,category.forEach((function(t){t.id==e.categoryid&&(r=t.name)})),plan.forEach((function(t){t.id==e.planid&&(m=t.name)}));let u="",p=0;n.forEach((function(t){t.serviceid==e.id&&(0==p?(u+=t.name,p++):u+=" | "+t.name)})),c=e.email,l=e.tel,i+=`\n        <fieldset>\n            <legend>${r} - ${m}</legend>\n        <div class="product">\n        <div class="slideshow-container" id="previewImageDiv">\n                <div class="mySlides fade">\n                    <picture>\n                        <source id="imgWebp" srcset="/images/${s}" type="image/webp">\n                        <source id="imgJPG" srcset="/images/${s}" type="image/jpeg">\n                        <img style="max-height: 50rem" id="imgPreview" loading="lazy" src="/images/${s}" >\n                    </picture>\n                </div>                 \n    </div>\n                    <h3>${a}</h3>\n                    <p>${d}</p>\n                    <p>${u}</p>\n                    <p>${g}</p>\n                  \x3c!--  <p>${r}</p>\n                    <p>${m}</p> --\x3e\n                    <p>${c}</p>\n                    <p>${l}</p>\n                    <a href="/services/edit?id=${o}" class="button">Editar anuncio</a>\n                    <a onclick="confirmDeleteService(${o})" class="button">Eliminar anuncio</a>\n                </div></fieldset>`});document.getElementById("product-section").innerHTML=i}function confirmDeleteService(e){Swal.fire({title:"Do you want to save the changes?",showCancelButton:!0,cancelButtonText:"Cancelar",cancelButtonColor:"red",confirmButtonText:"Confirmar"}).then(t=>{t.isConfirmed&&deleteService(e)})}async function deleteService(e){const t=new FormData;t.append("serviceid",e),url="http://localhost:3000/api/services/delete";const n=await fetch(url,{method:"POST",body:t}),i=await n.json();console.log(i),i?Swal.fire({icon:"success",title:"¡LISTO!",text:"Su servicio se ha eliminida correctamente",button:"OK"}).then(()=>{location.reload()}):Swal.fire({icon:"error",title:"ERROR",text:"Lo sentimos, se ha producido un error al eliminar el servicio",button:"OK"})}async function queryAPI(){console.log("result");try{const e="http://localhost:3000/api/services",t=await fetch(e),n=await t.json();console.log(n.userid),showServices(n)}catch(e){console.log(e)}}function showServices(e){document.getElementById("product-section").innerHTML='<div class="product">\n                <h3>Título del producto</h3>\n                <p>Descripción del producto</p>\n                <a href="#" class="button">Editar anuncio</a>\n            </div>'}function selectService(e){const{id:t}=e,{services:n}=Appointment,i=document.querySelector(`[data-id-service="${t}"]`);n.some(e=>e.id===t)?(Appointment.services=n.filter(e=>e.id!==t),i.classList.remove("selected")):(Appointment.services=[...n,e],i.classList.add("selected"))}function findID(){myid=document.querySelector("#accountid").value}function findName(){Appointment.name=document.querySelector("#name").value}function findDate(){document.querySelector("#date").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(showmAlert("Fines de semana no abrimos","error",".form",!0),e.target.value=""):Appointment.date=e.target.value}))}function findTime(){document.querySelector("#time").addEventListener("input",(function(e){const t=e.target.value.split(":")[0];t<10||t>18?(showmAlert("Hora no válida","error",".form",!0),e.target.value=""):Appointment.time=e.target.value}))}function showmAlert(e,t,n,i=!0){const o=document.querySelector(".alert");o&&o.remove();const s=document.createElement("DIV");s.textContent=e,s.classList.add("alert"),s.classList.add(t);document.querySelector(n).appendChild(s),i&&setTimeout(()=>{s.remove()},3e3)}function showResume(){const e=document.querySelector(".list-resume");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(Appointment).includes("")||0===Appointment.services.length)return void showmAlert("Falta información","error",".list-resume",!1);const{name:t,date:n,time:i,services:o}=Appointment,s=new Date(n),a=s.getMonth(),d=s.getDate()+2,c=s.getFullYear(),l=new Date(Date.UTC(c,a,d)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),r=document.createElement("P");r.innerHTML="<span>Nombre: </span>"+t;const m=document.createElement("P");m.innerHTML="<span>Fecha: </span>"+l;const g=document.createElement("P");g.innerHTML="<span>Hora: </span>"+i,e.appendChild(r),e.appendChild(m),e.appendChild(g),o.forEach(t=>{const{id:n,price:i,name:o}=t,s=document.createElement("DIV");s.classList.add("container-service");const a=document.createElement("P");a.textContent=o;const d=document.createElement("P");d.innerHTML="<span>Precio: </span> $"+i,s.appendChild(a),s.appendChild(d),e.appendChild(s)});const u=document.createElement("BUTTON");u.classList.add("button"),u.textContent="Reservar",u.onclick=bookDate,e.appendChild(u)}async function bookDate(){const{id:e,date:t,time:n,services:i}=Appointment,o=(i.map(e=>e.id),new FormData);o.append("userID",e),o.append("date",t),o.append("time",n);try{const e="http://localhost:3000/api/dates",t=await fetch(e,{method:"POST",body:o}),n=await t.json();console.log(n),n.result&&Swal.fire({icon:"success",title:"¡LISTO!",text:"Su cita se ha creado correctamente!",button:"OK"}).then(()=>{setTimeout(()=>{window.location.reload()},1500)})}catch(e){Swal.fire({icon:"error",title:"ERROR",text:"Lo sentimos, se ha producido un error al crear la cita",button:"OK"})}const s=await solved.json();console.log(s.result)}async function createToken(){const e=document.getElementById("accountid").value,t=new Date,n=`${t.getFullYear()}-${("0"+(t.getMonth()+1)).slice(-2)}-${("0"+t.getDate()).slice(-2)}`,i=new Date,o=`${("0"+i.getHours()).slice(-2)}:${("0"+i.getMinutes()).slice(-2)}:${("0"+i.getSeconds()).slice(-2)}`,s=new FormData;s.append("userID",e),s.append("date",n),s.append("time",o);try{const e="http://localhost:3000/api/createtoken",t=await fetch(e,{method:"POST",body:s}),n=await t.json();console.log(n),n.result?Swal.fire({icon:"success",title:"Verifica tu identidad",text:"Hemos enviado la solicitud de cambio de contraseña a tu correo electronico, por favor revisalo."}):Swal.fire({icon:"error",title:"Verifica tu identidad",text:"Algo ha acorrido, revisa tu email o intentalo nuevamente más tarde."})}catch(e){}}function confirmSendInstructions(){Swal.fire({title:"¿Solicitar cambio de contraseña?",text:"Enviaremos las instrucciones al correo electrónico",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Solicitar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&createToken()})}document.addEventListener("DOMContentLoaded",(function(){startApp(),eventListeners()}));